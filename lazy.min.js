(function(k){function p(a,b,d){return"function"===typeof d?p(d(a),d(b)):a===b?0:a>b?1:-1}function q(a,b){for(var d=-1;++d<a.length;)if(a[d]instanceof Array){if(!1===q(a[d],b))return!1}else if(!1===b(a[d]))return!1}function B(a){if(a.indexed)return a.get(0);var b;a.each(function(a){b=a;return!1});return b}function C(a){if(a.indexed)return a.get(a.length()-1);var b;a.each(function(a){b=a});return b}function D(a){return Array(a).join("  ")}var c=function(a){this.parent=a};c.inherit=function(a){a.prototype=
new c;return a};c.prototype.depth=function(){return this.parent?this.parent.depth()+1:0};c.prototype.log=function(a){console.log(D(this.depth())+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};c.prototype.map=function(a){return this.indexed?new r(this,a):new s(this,a)};c.prototype.pluck=function(a){return this.map(function(b){return b[a]})};c.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};
c.prototype.filter=function(a){return new t(this,a)};c.prototype.reject=function(a){return this.filter(function(b){return!a(b)})};c.prototype.where=function(a){return this.filter(function(b){for(var d in a)if(b[d]!==a[d])return!1;return!0})};c.prototype.reverse=function(){return this.indexed?new u(this):new v(this)};c.prototype.first=c.prototype.head=c.prototype.take=function(a){return"undefined"===typeof a?B(this):this.indexed?new w(this,a):new x(this,a)};c.prototype.initial=function(a){"undefined"===
typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?C(this):this.reverse().first()};c.prototype.findWhere=function(a){return this.where(a).first()};c.prototype.rest=c.prototype.tail=c.prototype.drop=function(a){return this.indexed?new m(this,a):new y(this,a)};c.prototype.sortBy=function(a){return new z(this,a)};c.prototype.groupBy=function(a){return new E(this,a)};c.prototype.countBy=function(a){return new F(this,a)};c.prototype.uniq=function(){return new G(this)};
c.prototype.zip=function(){return new H(this,Array.prototype.slice.call(arguments,0))};c.prototype.shuffle=function(){return new I(this)};c.prototype.flatten=function(){return new J(this)};c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=c.prototype.difference=function(){return new K(this,Array.prototype.slice.call(arguments,0))};c.prototype.union=function(){return new L(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(){return new M(this,
Array.prototype.slice.call(arguments,0))};c.prototype.every=c.prototype.all=function(a){var b=!0;this.each(function(d){if(!a(d))return b=!1});return b};c.prototype.some=c.prototype.any=function(a){a||(a=function(){return!0});var b=!1;this.each(function(d){if(a(d))return b=!0,!1});return b};c.prototype.isEmpty=function(){return!this.any()};c.prototype.indexOf=function(a){var b=0,d=-1;this.each(function(c){if(c===a)return d=b,!1;++b});return d};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);
-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=0,d=this.length(),c;b<d;)c=b+d>>>1,this.get(c)<a?b=c+1:d=c;return b};c.prototype.contains=function(a){return-1!==this.indexOf(a)};c.prototype.reduce=c.prototype.inject=c.prototype.foldl=function(a,b){this.each(function(d){b=a(b,d)});return b};c.prototype.reduceRight=c.prototype.foldr=function(a,b){return this.reverse().reduce(a,b)};c.prototype.find=c.prototype.detect=function(a){return this.filter(a).first()};c.prototype.min=
function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b>a?b:a})};var l=c.inherit(function(a){this.source=a});l.prototype.indexed=!0;l.prototype.get=function(a){return this.source[a]};l.prototype.length=function(){return this.source.length};l.prototype.each=function(a){for(var b=-1;++b<this.source.length&&!1!==a(this.source[b]););};var g=c.inherit(function(a){this.parent=a});g.inherit=
function(a){a.prototype=new g;return a};g.prototype.indexed=!0;g.prototype.get=function(a){return this.parent.get(a)};g.prototype.length=function(){return this.parent.length()};g.prototype.each=function(a){for(var b=this.length(),d=-1;++d<b&&!1!==a(this.get(d)););};var e=c.inherit(function(a){this.parent=a});e.inherit=function(a){a.prototype=new e;return a};e.prototype.indexed=!1;e.prototype.cache=function(){this.cached||(this.cached=this.toArray());return this.cached};e.prototype.get=function(a){return this.cache()[a]};
e.prototype.length=function(){return this.cache().length};var s=c.inherit(function(a,b){this.parent=a;this.mapFn=b});s.prototype.each=function(a){var b=this;b.parent.each(function(d){return a(b.mapFn(d))})};var r=g.inherit(function(a,b){this.parent=a;this.mapFn=b});r.prototype.get=function(a){return this.mapFn(this.parent.get(a))};var t=e.inherit(function(a,b){this.parent=a;this.filterFn=b});t.prototype.each=function(a){var b=this.filterFn;this.parent.each(function(d){if(b(d))return a(d)})};var v=
e.inherit(function(a){this.parent=a});v.prototype.each=function(a){for(var b=this.parent.toArray(),d=b.length;0<=--d&&!1!==a(b[d]););};var u=g.inherit(function(a){this.parent=a});u.prototype.get=function(a){return this.parent.get(this.length()-a-1)};var x=e.inherit(function(a,b){this.parent=a;this.count=b});x.prototype.each=function(a){var b=this,d=0;b.parent.each(function(c){c=a(c);return++d>=b.count?!1:c})};var w=g.inherit(function(a,b){this.parent=a;this.count=b});w.prototype.length=function(){var a=
this.parent.length();return this.count<=a?this.count:a};var y=e.inherit(function(a,b){this.parent=a;this.count=b});y.prototype.each=function(a){var b=this,d=0;b.parent.each(function(c){if(!(d++<b.count))return a(c)})};var m=g.inherit(function(a,b){this.parent=a;this.count=b});m.prototype.get=function(a){return this.parent.get(this.count+a)};m.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0};var z=e.inherit(function(a,b){this.parent=a;this.sortFn=b});z.prototype.each=
function(a){var b=this.sortFn,d=this.parent.toArray(),c=-1;for(d.sort(function(a,d){return p(a,d,b)});++c<d.length&&!1!==a(d[c]););};var I=e.inherit(function(a){this.each=function(b){for(var d=a.toArray(),c=d.length-1;0<c;--c){var h=d,e=Math.floor(Math.random()*c)+1,g=h[c];h[c]=h[e];h[e]=g;if(!1===b(d[c]))return}b(d[0])}}),E=e.inherit(function(a,b){this.each=function(c){var f={};a.each(function(a){var c=b(a);f[c]?f[c].push(a):f[c]=[a]});for(var h in f)c([h,f[h]])}}),F=e.inherit(function(a,b){this.each=
function(c){var f={};a.each(function(a){a=b(a);f[a]=f[a]?f[a]+1:1});for(var h in f)c([h,f[h]])}}),G=e.inherit(function(a){this.each=function(b){var c={};a.each(function(a){if(!(a in c))return c[a]=!0,b(a)})}}),J=e.inherit(function(a){this.each=function(b){a.each(function(a){return a instanceof Array?q(a,b):b(a)})}}),K=e.inherit(function(a,b){this.each=function(c){var f=new n(b);a.each(function(a){if(!f.contains(a))return c(a)})}}),L=e.inherit(function(a,b){this.each=function(c){var f=new n;a.each(function(a){f.contains(a)||
(f.add(a),c(a))});Lazy(b).flatten().each(function(a){f.contains(a)||(f.add(a),c(a))})}}),M=e.inherit(function(a,b){this.each=function(c){var f=Lazy(b).map(function(a){return new n(a)}).toArray();a.each(function(a){for(var b=0;b<f.length;++b)if(!f[b].contains(a))return;c(a)})}}),H=e.inherit(function(a,b){this.each=function(c){var f=0;a.each(function(a){a=[a];for(var e=0;e<b.length;++e)b[e].length>f&&a.push(b[e][f]);++f;return c(a)})}}),A=c.inherit(function(a){this.get=a;this.length=function(){throw"Cannot get the length of a generated sequence.";
};this.each=function(b){for(var c=0;!1!==b(a(c++)););}});k.Lazy=function(a){return a instanceof Lazy.Sequence?a:new l(a)};k.Lazy.generate=function(a){return new A(a)};k.Lazy.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+c*b}).take(Math.floor((b-a)/c))};k.Lazy.Sequence=c;k.Lazy.IndexedSequence=g;k.Lazy.CachingSequence=e;k.Lazy.GeneratedSequence=A;var n=function(a){var b=
{};Lazy(a||[]).flatten().each(function(a){b[a]=!0});this.add=function(a){b[a]=!0};this.contains=function(a){return b[a]}}})("undefined"!==typeof exports?exports:window);
