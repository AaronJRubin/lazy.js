(function(g){function n(a){var b={};Lazy(a||[]).flatten().each(function(a){b[a]=!0});return b}function p(a,b,e){return"function"===typeof e?p(e(a),e(b)):a===b?0:a>b?1:-1}function q(a,b){for(var e=-1;++e<a.length;)if(a[e]instanceof Array){if(!1===q(a[e],b))return!1}else if(!1===b(a[e]))return!1}function K(a){if(a.indexed)return a.get(0);var b;a.each(function(a){b=a;return!1});return b}function L(a){return Array(a).join("  ")}var c=function(a){this.parent=a};c.inherit=function(a){a.prototype=new c;
return a};c.prototype.depth=function(){return this.parent?this.parent.depth()+1:0};c.prototype.log=function(a){console.log(L(this.depth())+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};c.prototype.map=function(a){return this.indexed?new r(this,a):new s(this,a)};c.prototype.pluck=function(a){return this.map(function(b){return b[a]})};c.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};
c.prototype.select=c.prototype.filter=function(a){return this.indexed?new t(this,a):new u(this,a)};c.prototype.reject=function(a){return this.filter(function(b){return!a(b)})};c.prototype.where=function(a){return this.filter(function(b){for(var e in a)if(b[e]!==a[e])return!1;return!0})};c.prototype.reverse=function(){return this.indexed?new v(this):new w(this)};c.prototype.concat=function(){return new x(this,Array.prototype.slice.call(arguments,0))};c.prototype.first=c.prototype.head=c.prototype.take=
function(a){return"undefined"===typeof a?K(this):this.indexed?new y(this,a):new z(this,a)};c.prototype.initial=function(a){"undefined"===typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?this.reverse().first():this.reverse().take(a).reverse()};c.prototype.findWhere=function(a){return this.where(a).first()};c.prototype.rest=c.prototype.tail=c.prototype.drop=function(a){return this.indexed?new m(this,a):new A(this,a)};c.prototype.sortBy=function(a){return new B(this,
a)};c.prototype.groupBy=function(a){return new M(this,a)};c.prototype.countBy=function(a){return new N(this,a)};c.prototype.uniq=function(){return new C(this)};c.prototype.zip=function(){return new D(this,Array.prototype.slice.call(arguments,0))};c.prototype.shuffle=function(){return new E(this)};c.prototype.flatten=function(){return new F(this)};c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=c.prototype.difference=function(){return new G(this,Array.prototype.slice.call(arguments,
0))};c.prototype.union=function(){return new H(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(){return new I(this,Array.prototype.slice.call(arguments,0))};c.prototype.every=c.prototype.all=function(a){var b=!0;this.each(function(e){if(!a(e))return b=!1});return b};c.prototype.some=c.prototype.any=function(a){a||(a=function(){return!0});var b=!1;this.each(function(e){if(a(e))return b=!0,!1});return b};c.prototype.isEmpty=function(){return!this.any()};c.prototype.indexOf=
function(a){var b=0,e=-1;this.each(function(c){if(c===a)return e=b,!1;++b});return e};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=0,e=this.length(),c;b<e;)c=b+e>>>1,this.get(c)<a?b=c+1:e=c;return b};c.prototype.contains=function(a){return-1!==this.indexOf(a)};c.prototype.reduce=c.prototype.inject=c.prototype.foldl=function(a,b){this.each(function(e){b=a(b,e)});return b};c.prototype.reduceRight=
c.prototype.foldr=function(a,b){return this.reverse().reduce(a,b)};c.prototype.find=c.prototype.detect=function(a){return this.filter(a).first()};c.prototype.min=function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b>a?b:a})};c.prototype.join=function(a){var b="";this.each(function(e){0<b.length&&(b+=a);b+=e});return b};var h=c.inherit(function(a){this.source=a});h.prototype.indexed=
!0;h.prototype.get=function(a){return this.source[a]};h.prototype.length=function(){return this.source.length};h.prototype.each=function(a){for(var b=-1;++b<this.source.length&&!1!==a(this.source[b]););};h.prototype.toArray=function(){return this.source.slice(0)};var f=c.inherit(function(){});f.inherit=function(a){a.prototype=new f;return a};f.prototype.indexed=!0;f.prototype.get=function(a){return this.parent.get(a)};f.prototype.length=function(){return this.parent.length()};f.prototype.each=function(a){for(var b=
this.length(),e=-1;++e<b&&!1!==a(this.get(e)););};var d=c.inherit(function(){});d.inherit=function(a){a.prototype=new d;return a};d.prototype.indexed=!1;d.prototype.cache=function(){this.cached||(this.cached=this.toArray());return this.cached};d.prototype.get=function(a){return this.cache()[a]};d.prototype.length=function(){return this.cache().length};var s=c.inherit(function(a,b){this.parent=a;this.mapFn=b});s.prototype.each=function(a){var b=this.mapFn;this.parent.each(function(e){return a(b(e))})};
var r=f.inherit(function(a,b){this.parent=a;this.mapFn=b});r.prototype.get=function(a){return this.mapFn(this.parent.get(a))};var u=d.inherit(function(a,b){this.parent=a;this.filterFn=b});u.prototype.each=function(a){var b=this.filterFn;this.parent.each(function(e){if(b(e))return a(e)})};var t=d.inherit(function(a,b){this.parent=a;this.filterFn=b});t.prototype.each=function(a){for(var b=this.parent,e=this.filterFn,c=this.parent.length(),J=-1,d;++J<c&&!(d=b.get(J),e(d)&&!1===a(d)););};var w=d.inherit(function(a){this.parent=
a});w.prototype.each=function(a){for(var b=this.parent.toArray(),e=b.length;0<=--e&&!1!==a(b[e]););};var v=f.inherit(function(a){this.parent=a});v.prototype.get=function(a){return this.parent.get(this.length()-a-1)};var x=c.inherit(function(a,b){this.parent=a;this.arrays=b});x.prototype.each=function(a){var b=!1;this.parent.each(function(e){if(!1===a(e))return b=!0,!1});b||Lazy(this.arrays).flatten().each(a)};var z=d.inherit(function(a,b){this.parent=a;this.count=b});z.prototype.each=function(a){var b=
this,e=0;b.parent.each(function(c){c=a(c);return++e>=b.count?!1:c})};var y=f.inherit(function(a,b){this.parent=a;this.count=b});y.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a};var A=d.inherit(function(a,b){this.parent=a;this.count=b});A.prototype.each=function(a){var b=this,e=0;b.parent.each(function(c){if(!(e++<b.count))return a(c)})};var m=f.inherit(function(a,b){this.parent=a;this.count=b});m.prototype.get=function(a){return this.parent.get(this.count+
a)};m.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0};var B=d.inherit(function(a,b){this.parent=a;this.sortFn=b});B.prototype.each=function(a){var b=this.sortFn,e=this.parent.toArray(),c=-1;for(e.sort(function(a,e){return p(a,e,b)});++c<e.length&&!1!==a(e[c]););};var E=d.inherit(function(a){this.parent=a});E.prototype.each=function(a){for(var b=this.parent.toArray(),e=Math.floor,c=Math.random,d=b.length-1;0<d;--d){var k=b,f=e(c()*d)+1,g=k[d];k[d]=k[f];k[f]=
g;if(!1===a(b[d]))return}a(b[0])};var M=d.inherit(function(a,b){this.each=function(e){var c={};a.each(function(a){var e=b(a);c[e]?c[e].push(a):c[e]=[a]});for(var d in c)if(!1===e([d,c[d]]))break}}),N=d.inherit(function(a,b){this.each=function(c){var d={};a.each(function(a){a=b(a);d[a]=d[a]?d[a]+1:1});for(var f in d)c([f,d[f]])}}),C=d.inherit(function(a){this.parent=a});C.prototype.each=function(a){var b={};this.parent.each(function(c){if(!b[c])return b[c]=!0,a(c)})};var F=d.inherit(function(a){this.parent=
a});F.prototype.each=function(a){this.parent.each(function(b){return b instanceof Array?q(b,a):a(b)})};var G=d.inherit(function(a,b){this.parent=a;this.values=b});G.prototype.each=function(a){var b=n(this.values);this.parent.each(function(c){if(!b[c])return a(c)})};var H=d.inherit(function(a,b){this.parent=a;this.arrays=b});H.prototype.each=function(a){var b={},c=!1;this.parent.each(function(d){if(!b[d]&&(b[d]=!0,!1===a(d)))return c=!0,!1});c||Lazy(this.arrays).each(function(d){if(c)return!1;Lazy(d).each(function(d){if(!b[d]&&
(b[d]=!0,!1===a(d)))return c=!0,!1})})};var I=d.inherit(function(a,b){this.parent=a;this.arrays=b});I.prototype.each=function(a){var b=Lazy(this.arrays).map(function(a){return n(a)}).toArray();this.parent.each(function(c){for(var d=0;d<b.length;++d)if(!b[d][c])return;return a(c)})};var D=d.inherit(function(a,b){this.parent=a;this.arrays=b});D.prototype.each=function(a){var b=this.arrays,c=0;this.parent.each(function(d){d=[d];for(var f=0;f<b.length;++f)b[f].length>c&&d.push(b[f][c]);++c;return a(d)})};
var l=c.inherit(function(a){this.get=a});l.prototype.length=function(){throw"Cannot get the length of a generated sequence.";};l.prototype.each=function(a){for(var b=this.get,c=0;!1!==a(b(c++)););};g.Lazy=function(a){return a instanceof Lazy.Sequence?a:new h(a)};g.Lazy.generate=function(a){return new l(a)};g.Lazy.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+c*b}).take(Math.floor((b-
a)/c))};g.Lazy.Sequence=c;g.Lazy.IndexedSequence=f;g.Lazy.CachingSequence=d;g.Lazy.GeneratedSequence=l})("undefined"!==typeof exports?exports:window);
