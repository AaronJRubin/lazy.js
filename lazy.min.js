(function(g){function n(a,b,d){return"function"===typeof d?n(d(a),d(b)):a===b?0:a>b?1:-1}function p(a,b){for(var d=0;d<a.length&&!1!==b(a[d]);++d);}function q(a,b){for(var d=0;d<a.length;++d)if(a[d]instanceof Array){if(!1===q(a[d],b))return!1}else if(!1===b(a[d]))return!1}var c=function(a,b){this.parent=a;this.source=b;this.depth=a?a.depth+1:0;this.parent||(this.arraysCreated=0)};c.prototype.get=function(a){return this.source?this.source[a]:this.parent.get(a)};c.prototype.length=function(){return this.source?
this.source.length:this.parent.length()};c.prototype.root=function(){for(var a=this;a.parent;)a=a.parent;return a};c.prototype.arrayCount=function(){return this.root().arraysCreated};c.prototype.each=function(a){p(this.source,a)};c.prototype.log=function(a){console.log(Array(this.depth).join("  ")+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});this.root().arraysCreated+=1;return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};
c.prototype.map=function(a){return new h(this,a)};c.prototype.pluck=function(a){return new h(this,function(b){return b[a]})};c.prototype.invoke=function(a){return new h(this,function(b){return b[a]()})};c.prototype.filter=function(a){return new l(this,a)};c.prototype.reject=function(a){return new l(this,function(b){return!a(b)})};c.prototype.where=function(a){return new l(this,function(b){for(var d in a)if(b[d]!==a[d])return!1;return!0})};c.prototype.reverse=function(){return new r(this)};c.prototype.first=
c.prototype.head=c.prototype.take=function(a){return"undefined"===typeof a?this.get(0):new s(this,a)};c.prototype.initial=function(a){"undefined"===typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?this.get(this.length()-1):this.reverse().first()};c.prototype.findWhere=function(a){return this.where(a).first()};c.prototype.rest=c.prototype.tail=c.prototype.drop=function(a){return new t(this,a)};c.prototype.sortBy=function(a){return new u(this,
a)};c.prototype.groupBy=function(a){return new v(this,a)};c.prototype.countBy=function(a){return new w(this,a)};c.prototype.uniq=function(){return new x(this)};c.prototype.zip=function(){var a=Array.prototype.slice.call(arguments,0);return new y(this,a)};c.prototype.shuffle=function(){return new z(this)};c.prototype.flatten=function(){return new A(this)};c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=c.prototype.difference=function(){return new B(this,
Array.prototype.slice.call(arguments,0))};c.prototype.union=function(){return new C(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(){return new D(this,Array.prototype.slice.call(arguments,0))};c.prototype.every=c.prototype.all=function(a){var b=!0;this.each(function(d){if(!a(d))return b=!1});return b};c.prototype.some=c.prototype.any=function(a){a||(a=function(){return!0});var b=!1;this.each(function(d){if(a(d))return b=!0,!1});return b};c.prototype.isEmpty=function(){return!this.any()};
c.prototype.indexOf=function(a){var b=0,d=-1;this.each(function(c){if(c===a)return d=b,!1;++b});return d};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=0,d=this.length(),c;b<d;)c=b+d>>>1,this.get(c)<a?b=c+1:d=c;return b};c.prototype.contains=function(a){return-1!==this.indexOf(a)};c.prototype.reduce=c.prototype.inject=c.prototype.foldl=function(a,b){this.each(function(d){b=a(b,d)});return b};c.prototype.reduceRight=
c.prototype.foldr=function(a,b){return this.reverse().reduce(a,b)};c.prototype.find=c.prototype.detect=function(a){return this.filter(a).first()};c.prototype.min=function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b>a?b:a})};c.inherit=function(a){var b=function(){c.call(this,arguments[0]);a.apply(this,arguments)};b.prototype=c.prototype;return b};var e=c.inherit(function(a){var b;
this.cache=function(){b||(b=this.toArray());return b};this.get=function(a){return this.cache()[a]};this.length=function(){return this.cache().length}});e.inherit=function(a){var b=function(){e.call(this,arguments[0]);a.apply(this,arguments)};b.prototype=e.prototype;return b};var h=c.inherit(function(a,b){this.get=function(d){return b(a.get(d))};this.each=function(d){a.each(function(a){return d(b(a))})}}),l=e.inherit(function(a,b){this.each=function(d){a.each(function(a){if(b(a))return d(a)})}}),r=
c.inherit(function(a){this.get=function(b){return a.get(a.length()-b-1)};this.length=function(){return a.length()};this.each=function(b){for(var d=a.length()-1;0<=d&&!1!==b(a.get(d));--d);}}),s=e.inherit(function(a,b){this.each=function(d){var c=0;a.each(function(a){a=d(a);return++c>=b?!1:a})}}),t=e.inherit(function(a,b){this.each=function(d){var c=0;a.each(function(a){if(!(c++<b))return d(a)})}}),u=e.inherit(function(a,b){this.each=function(d){var c=a.toArray();c.sort(function(a,d){return n(a,d,
b)});p(c,d)}}),v=e.inherit(function(a,b){this.each=function(d){var c={};a.each(function(a){var d=b(a);c[d]?c[d].push(a):c[d]=[a]});for(var k in c)d([k,c[k]])}}),w=e.inherit(function(a,b){this.each=function(d){var c={};a.each(function(a){a=b(a);c[a]=c[a]?c[a]+1:1});for(var k in c)d([k,c[k]])}}),x=e.inherit(function(a){this.each=function(b){var c={};a.each(function(a){if(!(a in c))return c[a]=!0,b(a)})}}),B=e.inherit(function(a,b){this.each=function(c){var f=new m(b);a.each(function(a){if(!f.contains(a))return c(a)})}}),
C=e.inherit(function(a,b){this.each=function(c){var f=new m;a.each(function(a){f.contains(a)||(f.add(a),c(a))});Lazy(b).flatten().each(function(a){f.contains(a)||(f.add(a),c(a))})}}),D=e.inherit(function(a,b){this.each=function(c){var f=Lazy(b).map(function(a){return new m(a)}).toArray();a.each(function(a){for(var b=0;b<f.length;++b)if(!f[b].contains(a))return;c(a)})}}),y=e.inherit(function(a,b){this.each=function(c){var f=0;a.each(function(a){a=[a];for(var e=0;e<b.length;++e)b[e].length>f&&a.push(b[e][f]);
++f;return c(a)})}}),z=e.inherit(function(a){this.each=function(b){for(var c=a.toArray(),f=c.length-1;0<f;--f){var e=c,g=Math.floor(Math.random()*f)+1,h=e[f];e[f]=e[g];e[g]=h;if(!1===b(c[f]))return}b(c[0])}}),A=e.inherit(function(a){this.each=function(b){a.each(function(a){return a instanceof Array?q(a,b):b(a)})}}),E=c.inherit(function(a){this.get=a;this.length=function(){throw"Cannot get the length of a generated sequence.";};this.each=function(b){for(var c=0;!1!==b(a(c++)););}});g.Lazy=function(a){return a instanceof
c?a:new c(null,a)};g.Lazy.generate=function(a){return new E(a)};g.Lazy.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+c*b}).take(Math.floor((b-a)/c))};var m=function(a){var b={};Lazy(a||[]).flatten().each(function(a){b[a]=!0});this.add=function(a){b[a]=!0};this.contains=function(a){return b[a]}}})("undefined"===typeof exports?window:exports);
