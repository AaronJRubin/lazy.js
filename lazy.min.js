(function(q){function c(){}function T(a){if("undefined"===typeof a){if("function"===typeof q.setImmediate)return q.setImmediate;if("undefined"!==typeof process&&"function"===typeof process.nextTick)return process.nextTick}a=a||0;return function(b){setTimeout(b,a)}}function A(a){var b=new k;g(a||[]).flatten().each(function(a){b.add(a)});return b}function B(a,b,d){return"function"===typeof d?B(d(a),d(b)):a===b?0:a>b?1:-1}function C(a,b){for(var d=-1;++d<a.length;)if(a[d]instanceof Array){if(!1===C(a[d],
b))return!1}else if(!1===b(a[d]))return!1}function U(a){return Array(a).join("  ")}c.inherit=function(a){a.prototype=new c;return a};c.prototype.depth=function(){return this.parent?this.parent.depth()+1:0};c.prototype.log=function(a){console.log(U(this.depth())+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};c.prototype.forEach=function(a){this.each(a)};c.prototype.map=c.prototype.collect=
function(a){return new D(this,a)};c.prototype.pluck=function(a){return this.map(function(b){return b[a]})};c.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};c.prototype.filter=c.prototype.select=function(a){return new r(this,a)};c.prototype.reject=function(a){return this.filter(function(b){return!a(b)})};c.prototype.where=function(a){return this.filter(function(b){for(var d in a)if(b[d]!==a[d])return!1;return!0})};c.prototype.reverse=function(){return new E(this)};c.prototype.concat=
function(){return new F(this,Array.prototype.slice.call(arguments,0))};c.prototype.first=c.prototype.head=c.prototype.take=function(a){if("undefined"===typeof a){var b;this.each(function(a){b=a;return!1});return b}return new G(this,a)};c.prototype.initial=function(a){"undefined"===typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?this.reverse().first():this.reverse().take(a).reverse()};c.prototype.findWhere=function(a){return this.where(a).first()};
c.prototype.rest=c.prototype.tail=c.prototype.drop=function(a){return new H(this,a)};c.prototype.sortBy=function(a){return new I(this,a)};c.prototype.groupBy=function(a){return new V(this,a)};c.prototype.countBy=function(a){return new W(this,a)};c.prototype.uniq=c.prototype.unique=function(){return new J(this)};c.prototype.zip=function(){return new K(this,Array.prototype.slice.call(arguments,0))};c.prototype.shuffle=function(){return new L(this)};c.prototype.flatten=function(){return new M(this)};
c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=c.prototype.difference=function(){return new N(this,Array.prototype.slice.call(arguments,0))};c.prototype.union=function(){return new O(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(){return new P(this,Array.prototype.slice.call(arguments,0))};c.prototype.every=c.prototype.all=function(a){var b=!0;this.each(function(d){if(!a(d))return b=!1});return b};c.prototype.some=
c.prototype.any=function(a){a||(a=function(){return!0});var b=!1;this.each(function(d){if(a(d))return b=!0,!1});return b};c.prototype.isEmpty=function(){return!this.any()};c.prototype.indexOf=function(a){var b=0,d=-1;this.each(function(c){if(c===a)return d=b,!1;++b});return d};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=0,d=this.length(),c;b<d;)c=b+d>>>1,this.get(c)<a?b=c+1:d=c;return b};c.prototype.contains=
function(a){return-1!==this.indexOf(a)};c.prototype.reduce=c.prototype.inject=c.prototype.foldl=function(a,b){this.each(function(d){b=a(b,d)});return b};c.prototype.reduceRight=c.prototype.foldr=function(a,b){return this.reverse().reduce(a,b)};c.prototype.find=c.prototype.detect=function(a){return this.filter(a).first()};c.prototype.min=function(){return this.reduce(function(a,b){return"undefined"===typeof a?b:b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,b){return"undefined"===
typeof a?b:b>a?b:a})};c.prototype.join=function(a){var b="";this.each(function(d){0<b.length&&(b+=a);b+=d});return b};c.prototype.getIterator=function(){return new s(this)};c.prototype.async=function(a){return new l(this,a)};var s=function(a){this.sequence=a;this.index=-1};s.prototype.current=function(){return this.sequence.get(this.index)};s.prototype.moveNext=function(){if(this.index>=this.sequence.length()-1)return!1;++this.index;return!0};var k=function(){this.table={}};k.prototype.add=function(a){var b=
this.table,d=typeof a;a="@"+a;return!b[d]?(b[d]={},b[d][a]=!0):b[d][a]?!1:b[d][a]=!0};k.prototype.contains=function(a){var b=this.table[typeof a];return b&&b["@"+a]};var e=c.inherit(function(){});e.inherit=function(a){a.prototype=new e;return a};e.prototype.get=function(a){return this.parent.get(a)};e.prototype.length=function(){return this.parent.length()};e.prototype.each=function(a){for(var b=this.length(),d=-1;++d<b&&!1!==a(this.get(d)););};e.prototype.map=e.prototype.collect=function(a){return new Q(this,
a)};e.prototype.filter=e.prototype.select=function(a){return new t(this,a)};e.prototype.reverse=function(){return new R(this)};e.prototype.first=e.prototype.head=e.prototype.take=function(a){return"undefined"===typeof a?this.get(0):new S(this,a)};e.prototype.rest=e.prototype.tail=e.prototype.drop=function(a){return new u(this,a)};var h=e.inherit(function(a){this.source=a});h.prototype.get=function(a){return this.source[a]};h.prototype.length=function(){return this.source.length};h.prototype.each=
function(a){for(var b=-1;++b<this.source.length&&!1!==a(this.source[b]););};h.prototype.toArray=function(){return this.source.slice(0)};var f=c.inherit(function(){});f.inherit=function(a){a.prototype=new f;return a};f.prototype.cache=function(){this.cached||(this.cached=this.toArray());return this.cached};f.prototype.get=function(a){return this.cache()[a]};f.prototype.length=function(){return this.cache().length};var D=c.inherit(function(a,b){this.parent=a;this.mapFn=b});D.prototype.each=function(a){var b=
this.mapFn;this.parent.each(function(d){return a(b(d))})};var Q=e.inherit(function(a,b){this.parent=a;this.mapFn=b});Q.prototype.get=function(a){return this.mapFn(this.parent.get(a))};var r=f.inherit(function(a,b){this.parent=a;this.filterFn=b});r.prototype.getIterator=function(){return new m(this.parent,this.filterFn)};r.prototype.each=function(a){var b=this.filterFn;this.parent.each(function(d){if(b(d))return a(d)})};var t=f.inherit(function(a,b){this.parent=a;this.filterFn=b});t.prototype.getIterator=
function(){return new m(this.parent,this.filterFn)};t.prototype.each=function(a){for(var b=this.parent,d=this.filterFn,c=this.parent.length(),n=-1,e;++n<c&&!(e=b.get(n),d(e)&&!1===a(e)););};var m=function(a,b){this.iterator=a.getIterator();this.filterFn=b};m.prototype.current=function(){return this.value};m.prototype.moveNext=function(){for(var a=this.iterator,b=this.filterFn,d;a.moveNext();)if(d=a.current(),b(d))return this.value=d,!0;this.value=void 0;return!1};var E=f.inherit(function(a){this.parent=
a});E.prototype.each=function(a){for(var b=this.parent.toArray(),d=b.length;0<=--d&&!1!==a(b[d]););};var R=e.inherit(function(a){this.parent=a});R.prototype.get=function(a){return this.parent.get(this.length()-a-1)};var F=c.inherit(function(a,b){this.parent=a;this.arrays=b});F.prototype.each=function(a){var b=!1;this.parent.each(function(d){if(!1===a(d))return b=!0,!1});b||g(this.arrays).flatten().each(a)};var G=f.inherit(function(a,b){this.parent=a;this.count=b});G.prototype.each=function(a){var b=
this,d=0;b.parent.each(function(c){c=a(c);return++d>=b.count?!1:c})};var S=e.inherit(function(a,b){this.parent=a;this.count=b});S.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a};var H=f.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});H.prototype.each=function(a){var b=this,d=0;b.parent.each(function(c){if(!(d++<b.count))return a(c)})};var u=e.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});u.prototype.get=
function(a){return this.parent.get(this.count+a)};u.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0};var I=f.inherit(function(a,b){this.parent=a;this.sortFn=b});I.prototype.each=function(a){var b=this.sortFn,d=this.parent.toArray(),c=-1;for(d.sort(function(a,d){return B(a,d,b)});++c<d.length&&!1!==a(d[c]););};var L=f.inherit(function(a){this.parent=a});L.prototype.each=function(a){for(var b=this.parent.toArray(),d=Math.floor,c=Math.random,e=b.length-1;0<
e;--e){var f=b,g=d(c()*e)+1,h=f[e];f[e]=f[g];f[g]=h;if(!1===a(b[e]))return}a(b[0])};var V=f.inherit(function(a,b){this.each=function(d){var c={};a.each(function(a){var d=b(a);c[d]?c[d].push(a):c[d]=[a]});for(var e in c)if(!1===d([e,c[e]]))break}}),W=f.inherit(function(a,b){this.each=function(d){var c={};a.each(function(a){a=b(a);c[a]=c[a]?c[a]+1:1});for(var e in c)d([e,c[e]])}}),J=f.inherit(function(a){this.parent=a});J.prototype.each=function(a){var b=new k;this.parent.each(function(d){if(b.add(d))return a(d)})};
var M=f.inherit(function(a){this.parent=a});M.prototype.each=function(a){this.parent.each(function(b){return b instanceof Array?C(b,a):a(b)})};var N=f.inherit(function(a,b){this.parent=a;this.values=b});N.prototype.each=function(a){var b=A(this.values);this.parent.each(function(d){if(!b.contains(d))return a(d)})};var O=f.inherit(function(a,b){this.parent=a;this.arrays=b});O.prototype.each=function(a){var b={},d=!1;this.parent.each(function(c){if(!b[c]&&(b[c]=!0,!1===a(c)))return d=!0,!1});d||g(this.arrays).each(function(c){if(d)return!1;
g(c).each(function(c){if(!b[c]&&(b[c]=!0,!1===a(c)))return d=!0,!1})})};var P=f.inherit(function(a,b){this.parent=a;this.arrays=b});P.prototype.each=function(a){var b=g(this.arrays).map(function(a){return A(a)}).toArray();this.parent.each(function(c){for(var e=0;e<b.length;++e)if(!b[e].contains(c))return;return a(c)})};var K=f.inherit(function(a,b){this.parent=a;this.arrays=b});K.prototype.each=function(a){var b=this.arrays,c=0;this.parent.each(function(e){e=[e];for(var f=0;f<b.length;++f)b[f].length>
c&&e.push(b[f][c]);++c;return a(e)})};var p=c.inherit(function(a,b){this.get=a;this.fixedLength=b});p.prototype.length=function(){return this.fixedLength};p.prototype.each=function(a){for(var b=this.get,c=this.fixedLength,e=0;("undefined"===typeof c||e<c)&&!1!==a(b(e++)););};var l=c.inherit(function(a,b){if(a instanceof l)throw"Sequence is already asynchronous!";this.parent=a;this.onNextCallback=T(b)});l.prototype.each=function(a){var b=this.parent.getIterator(),c=this.onNextCallback;b.moveNext()&&
c(function n(){!1!==a(b.current())&&b.moveNext()&&c(n)})};var v=function(a){this.source=a};v.prototype.match=function(a){return new w(this.source,a)};v.prototype.split=function(a){return new x(this.source,a)};var w=c.inherit(function(a,b){this.source=a;this.pattern=b});w.prototype.each=function(a){var b=this.source,c=this.pattern,e;if(""===c.source||"(?:)"===c.source)eachChar(str,a);else for(c=eval(""+c+(!c.global?"g":""));(e=c.exec(b))&&!1!==a(e[0]););};w.prototype.getIterator=function(){var a=this.source,
b=this.pattern,c;if(""===b.source||"(?:)"===b.source)return new j(a);b=eval(""+b+(!b.global?"g":""));return{current:function(){return c[0]},moveNext:function(){return!!(c=b.exec(a))}}};var x=c.inherit(function(a,b){this.source=a;this.pattern=b});x.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););};x.prototype.getIterator=function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new j(this.source):new y(this.source,
this.pattern):""===this.pattern?new j(this.source):new z(this.source,this.pattern)};var y=function(a,b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))};y.prototype.current=function(){return this.source.substring(this.start,this.end)};y.prototype.moveNext=function(){if(!this.pattern)return!1;var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,!0):this.pattern?(this.start=this.nextStart,this.pattern=
this.nextStart=this.end=void 0,!0):!1};var z=function(a,b){this.source=a;this.delimiter=b};z.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)};z.prototype.moveNext=function(){this.finished||(this.leftIndex="undefined"!==typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex));return-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished};var j=function(a){this.source=
a;this.index=-1};j.prototype.current=function(){return this.source.charAt(this.index)};j.prototype.moveNext=function(){return++this.index<this.source.length};var g=function(a){return a instanceof c?a:"string"===typeof a?new v(a):new h(a)};g.async=function(a,b){return new l(new h(a),b)};g.generate=function(a,b){return new p(a,b)};g.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+
c*b}).take(Math.floor((b-a)/c))};g.Sequence=c;g.IndexedSequence=e;g.CachingSequence=f;g.GeneratedSequence=p;"undefined"!==typeof module?module.exports=g:q.Lazy=g})("undefined"!==typeof global?global:window);
