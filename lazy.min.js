(function(r){function c(){}function s(a){this.sequence=a;this.index=-1}function l(){this.table={}}function m(a,b){this.iterator=a.getIterator();this.filterFn=b}function V(a){if("undefined"===typeof a){if("function"===typeof r.setImmediate)return r.setImmediate;if("undefined"!==typeof process&&"function"===typeof process.nextTick)return process.nextTick}a=a||0;return function(b){setTimeout(b,a)}}function t(a){this.source=a}function u(a,b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))}function v(a,
b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))}function w(a,b){this.source=a;this.delimiter=b}function n(a){this.source=a;this.index=-1}function D(a){var b=new l;h(a||[]).flatten().each(function(a){b.add(a)});return b}function x(a,b,g){return"function"===typeof g?x(g(a),g(b)):a===b?0:a>b?1:-1}function E(a,b,g){g=g||[0];for(var c=-1;++c<a.length;)if(a[c]instanceof Array){if(!1===E(a[c],b,g))return!1}else if(!1===b(a[c],g[0]++))return!1;return!0}function W(a){return Array(a).join("  ")}
c.inherit=function(a){a.prototype=new c;return a};c.prototype.depth=function(){return this.parent?this.parent.depth()+1:0};c.prototype.log=function(a){console.log(W(this.depth())+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};c.prototype.forEach=function(a){this.each(a)};c.prototype.map=function(a){return new F(this,a)};c.prototype.collect=c.prototype.map;c.prototype.pluck=
function(a){return this.map(function(b){return b[a]})};c.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};c.prototype.select=function(a){return new y(this,a)};c.prototype.filter=c.prototype.select;c.prototype.reject=function(a){return this.filter(function(b){return!a(b)})};c.prototype.where=function(a){return this.filter(function(b){for(var g in a)if(b[g]!==a[g])return!1;return!0})};c.prototype.reverse=function(){return new G(this)};c.prototype.concat=function(a){return new H(this,
Array.prototype.slice.call(arguments,0))};c.prototype.first=function(a){if("undefined"===typeof a){var b;this.each(function(a){b=a;return!1});return b}return new I(this,a)};c.prototype.head=c.prototype.take=c.prototype.first;c.prototype.initial=function(a){"undefined"===typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?this.reverse().first():this.reverse().take(a).reverse()};c.prototype.findWhere=function(a){return this.where(a).first()};
c.prototype.rest=function(a){return new J(this,a)};c.prototype.tail=c.prototype.drop=c.prototype.rest;c.prototype.sortBy=function(a){return new K(this,a)};c.prototype.groupBy=function(a){return new X(this,a)};c.prototype.countBy=function(a){return new Y(this,a)};c.prototype.uniq=function(){return new L(this)};c.prototype.unique=c.prototype.uniq;c.prototype.zip=function(a){return new M(this,Array.prototype.slice.call(arguments,0))};c.prototype.shuffle=function(){return new N(this)};c.prototype.flatten=
function(){return new O(this)};c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=function(a){return new P(this,Array.prototype.slice.call(arguments,0))};c.prototype.difference=c.prototype.without;c.prototype.union=function(a){return new Q(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(a){return new R(this,Array.prototype.slice.call(arguments,0))};c.prototype.every=function(a){var b=!0;this.each(function(g){if(!a(g))return b=
!1});return b};c.prototype.all=c.prototype.every;c.prototype.some=function(a){a||(a=function(){return!0});var b=!1;this.each(function(g){if(a(g))return b=!0,!1});return b};c.prototype.any=c.prototype.some;c.prototype.isEmpty=function(){return!this.any()};c.prototype.indexOf=function(a){var b=0,g=-1;this.each(function(c){if(c===a)return g=b,!1;++b});return g};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=
0,g=this.length(),c;b<g;)c=b+g>>>1,-1===x(this.get(c),a)?b=c+1:g=c;return b};c.prototype.contains=function(a){return-1!==this.indexOf(a)};c.prototype.reduce=function(a,b){if(2>arguments.length)return this.tail().reduce(a,this.head());this.each(function(g,c){b=a(b,g,c)});return b};c.prototype.inject=c.prototype.foldl=c.prototype.reduce;c.prototype.reduceRight=function(a,b){var c=this.length()-1;return this.reverse().reduce(function(b,j){return a(b,j,c--)},b)};c.prototype.foldr=c.prototype.reduceRight;
c.prototype.find=function(a){return this.filter(a).first()};c.prototype.detect=c.prototype.find;c.prototype.min=function(){return this.reduce(function(a,b){return b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,b){return b>a?b:a})};c.prototype.join=function(a){var b="";this.each(function(c){0<b.length&&(b+=a);b+=c});return b};c.prototype.getIterator=function(){return new s(this)};c.prototype.async=function(a){return new p(this,a)};s.prototype.current=function(){return this.sequence.get(this.index)};
s.prototype.moveNext=function(){if(this.index>=this.sequence.length()-1)return!1;++this.index;return!0};l.prototype.add=function(a){var b=this.table,c=typeof a;a="@"+a;return!b[c]?(b[c]={},b[c][a]=!0):b[c][a]?!1:b[c][a]=!0};l.prototype.contains=function(a){var b=this.table[typeof a];return b&&b["@"+a]};var d=c.inherit(function(){});d.inherit=function(a){a.prototype=new d;return a};d.prototype.get=function(a){return this.parent.get(a)};d.prototype.length=function(){return this.parent.length()};d.prototype.each=
function(a){for(var b=this.length(),c=-1;++c<b&&!1!==a(this.get(c),c););};d.prototype.map=d.prototype.collect=function(a){return new S(this,a)};d.prototype.filter=d.prototype.select=function(a){return new z(this,a)};d.prototype.reverse=function(){return new T(this)};d.prototype.first=d.prototype.head=d.prototype.take=function(a){return"undefined"===typeof a?this.get(0):new U(this,a)};d.prototype.rest=d.prototype.tail=d.prototype.drop=function(a){return new A(this,a)};var k=d.inherit(function(a){this.source=
a});k.prototype.get=function(a){return this.source[a]};k.prototype.length=function(){return this.source.length};k.prototype.each=function(a){for(var b=-1;++b<this.source.length&&!1!==a(this.source[b],b););};k.prototype.toArray=function(){return this.source.slice(0)};var f=c.inherit(function(){});f.inherit=function(a){a.prototype=new f;return a};f.prototype.cache=function(){this.cached||(this.cached=this.toArray());return this.cached};f.prototype.get=function(a){return this.cache()[a]};f.prototype.length=
function(){return this.cache().length};var F=c.inherit(function(a,b){this.parent=a;this.mapFn=b});F.prototype.each=function(a){var b=this.mapFn;this.parent.each(function(c,e){return a(b(c,e),e)})};var S=d.inherit(function(a,b){this.parent=a;this.mapFn=b});S.prototype.get=function(a){return this.mapFn(this.parent.get(a),a)};var y=f.inherit(function(a,b){this.parent=a;this.filterFn=b});y.prototype.getIterator=function(){return new m(this.parent,this.filterFn)};y.prototype.each=function(a){var b=this.filterFn,
c=0;this.parent.each(function(e,j){if(b(e,j))return a(e,c++)})};var z=f.inherit(function(a,b){this.parent=a;this.filterFn=b});z.prototype.getIterator=function(){return new m(this.parent,this.filterFn)};z.prototype.each=function(a){for(var b=this.parent,c=this.filterFn,e=this.parent.length(),j=-1,Z=0,d;++j<e&&!(d=b.get(j),c(d,j)&&!1===a(d,Z++)););};m.prototype.current=function(){return this.value};m.prototype.moveNext=function(){for(var a=this.iterator,b=this.filterFn,c;a.moveNext();)if(c=a.current(),
b(c))return this.value=c,!0;this.value=void 0;return!1};var G=f.inherit(function(a){this.parent=a});G.prototype.each=function(a){for(var b=this.parent.toArray(),c=b.length;0<=--c&&!1!==a(b[c]););};var T=d.inherit(function(a){this.parent=a});T.prototype.get=function(a){return this.parent.get(this.length()-a-1)};var H=c.inherit(function(a,b){this.parent=a;this.arrays=b});H.prototype.each=function(a){var b=!1,c=0;this.parent.each(function(e){if(!1===a(e,c++))return b=!0,!1});b||h(this.arrays).flatten().each(function(b){if(!1===
a(b,c++))return!1})};var I=f.inherit(function(a,b){this.parent=a;this.count=b});I.prototype.each=function(a){var b=this,c=0;b.parent.each(function(e){e=a(e);return++c>=b.count?!1:e})};var U=d.inherit(function(a,b){this.parent=a;this.count=b});U.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a};var J=f.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});J.prototype.each=function(a){var b=this,c=0;b.parent.each(function(e){if(!(c++<b.count))return a(e)})};
var A=d.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});A.prototype.get=function(a){return this.parent.get(this.count+a)};A.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0};var K=f.inherit(function(a,b){this.parent=a;this.sortFn=b});K.prototype.each=function(a){var b=this.sortFn,c=this.parent.toArray(),e=-1;for(c.sort(function(a,c){return x(a,c,b)});++e<c.length&&!1!==a(c[e],e););};var N=f.inherit(function(a){this.parent=a});N.prototype.each=
function(a){for(var b=this.parent.toArray(),c=Math.floor,e=Math.random,j=0,d=b.length-1;0<d;--d){var f=b,h=c(e()*d)+1,k=f[d];f[d]=f[h];f[h]=k;if(!1===a(b[d],j++))return}a(b[0],j)};var X=f.inherit(function(a,b){this.each=function(c){var e={};a.each(function(a){var c=b(a);e[c]?e[c].push(a):e[c]=[a]});for(var d in e)if(!1===c([d,e[d]]))break}}),Y=f.inherit(function(a,b){this.each=function(c){var e={};a.each(function(a){a=b(a);e[a]=e[a]?e[a]+1:1});for(var d in e)c([d,e[d]])}}),L=f.inherit(function(a){this.parent=
a});L.prototype.each=function(a){var b=new l,c=0;this.parent.each(function(e){if(b.add(e))return a(e,c++)})};var O=f.inherit(function(a){this.parent=a});O.prototype.each=function(a){var b=[0];this.parent.each(function(c){return c instanceof Array?E(c,a,b):a(c,b[0]++)})};var P=f.inherit(function(a,b){this.parent=a;this.values=b});P.prototype.each=function(a){var b=D(this.values),c=0;this.parent.each(function(e){if(!b.contains(e))return a(e,c++)})};var Q=f.inherit(function(a,b){this.parent=a;this.arrays=
b});Q.prototype.each=function(a){var b={},c=0,e=!1;this.parent.each(function(d){if(!b[d]&&(b[d]=!0,!1===a(d,c++)))return e=!0,!1});e||h(this.arrays).each(function(d){if(e)return!1;h(d).each(function(d){if(!b[d]&&(b[d]=!0,!1===a(d,c++)))return e=!0,!1})})};var R=f.inherit(function(a,b){this.parent=a;this.arrays=b});R.prototype.each=function(a){var b=h(this.arrays).map(function(a){return D(a)}).toArray(),c=0;this.parent.each(function(e){for(var d=-1;++d<b.length;)if(!b[d].contains(e))return;return a(e,
c++)})};var M=f.inherit(function(a,b){this.parent=a;this.arrays=b});M.prototype.each=function(a){var b=this.arrays,c=0;this.parent.each(function(e){e=[e];for(var d=0;d<b.length;++d)b[d].length>c&&e.push(b[d][c]);return a(e,c++)})};var q=c.inherit(function(a,b){this.get=a;this.fixedLength=b});q.prototype.length=function(){return this.fixedLength};q.prototype.each=function(a){for(var b=this.get,c=this.fixedLength,d=0;("undefined"===typeof c||d<c)&&!1!==a(b(d++)););};var p=c.inherit(function(a,b){if(a instanceof
p)throw"Sequence is already asynchronous!";this.parent=a;this.onNextCallback=V(b)});p.prototype.each=function(a){var b=this.parent.getIterator(),c=this.onNextCallback;b.moveNext()&&c(function j(){!1!==a(b.current())&&b.moveNext()&&c(j)})};t.prototype.match=function(a){return new B(this.source,a)};t.prototype.split=function(a){return new C(this.source,a)};var B=c.inherit(function(a,b){this.source=a;this.pattern=b});B.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););
};B.prototype.getIterator=function(){return new u(this.source,this.pattern)};u.prototype.current=function(){return this.match[0]};u.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))};var C=c.inherit(function(a,b){this.source=a;this.pattern=b});C.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););};C.prototype.getIterator=function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new n(this.source):
new v(this.source,this.pattern):""===this.pattern?new n(this.source):new w(this.source,this.pattern)};v.prototype.current=function(){return this.source.substring(this.start,this.end)};v.prototype.moveNext=function(){if(!this.pattern)return!1;var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,!0):this.pattern?(this.start=this.nextStart,this.pattern=this.nextStart=this.end=void 0,!0):!1};w.prototype.current=function(){return this.source.substring(this.leftIndex,
this.rightIndex)};w.prototype.moveNext=function(){this.finished||(this.leftIndex="undefined"!==typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex));return-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished};n.prototype.current=function(){return this.source.charAt(this.index)};n.prototype.moveNext=function(){return++this.index<this.source.length};var h=function(a){return a instanceof c?a:"string"===
typeof a?new t(a):new k(a)};h.async=function(a,b){return new p(new k(a),b)};h.generate=function(a,b){return new q(a,b)};h.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+c*b}).take(Math.floor((b-a)/c))};h.Sequence=c;h.IndexedSequence=d;h.CachingSequence=f;h.GeneratedSequence=q;"undefined"!==typeof module?module.exports=h:r.Lazy=h})("undefined"!==typeof global?global:
window);
